<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Pro Notes & Calc Ultimate</title>
<style>
    :root {
        --bg: #f2f2f7; --card: #ffffff; --text: #000000;
        --accent: #007aff; --orange: #ff9500; --red: #ff3b30;
        --sheet-bg: rgba(245, 245, 247, 0.98);
        --btn-grey: #e5e5ea; --btn-text: #000;
        --border: #c6c6c8; --blur: blur(20px);
    }
    [data-theme="dark"] {
        --bg: #000000; --card: #1c1c1e; --text: #ffffff;
        --sheet-bg: rgba(30, 30, 30, 0.98);
        --btn-grey: #3a3a3c; --btn-text: #fff;
        --border: #38383a;
    }

    * { box-sizing: border-box; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
    
    body {
        margin: 0; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
        background: var(--bg); color: var(--text); 
        height: 100dvh; overflow: hidden; display: flex; flex-direction: column;
    }

    /* --- EDITOR DE NOTAS --- */
    .editor-area { flex: 1; display: flex; flex-direction: column; padding: 20px 20px 110px 20px; position: relative; }
    
    input#titleInput {
        background: transparent; border: none; font-size: 2.2rem; font-weight: 700;
        color: var(--text); outline: none; margin-bottom: 15px; width: 100%;
    }
    textarea#noteBody {
        flex: 1; background: transparent; border: none; font-size: 1.2rem; line-height: 1.6;
        color: var(--text); outline: none; resize: none;
    }

    /* --- PREVIEW BUBBLE --- */
    .calc-preview-bubble {
        position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px);
        background: var(--card); border: 1px solid var(--accent); color: var(--accent);
        padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 0.95rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1); pointer-events: none; opacity: 0;
        transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 50;
        display: flex; align-items: center; gap: 8px;
    }
    .calc-preview-bubble.active { opacity: 1; transform: translateX(-50%) translateY(0); }
    .calc-preview-bubble span { color: var(--text); opacity: 0.5; font-weight: 400; font-size: 0.8rem; }

    /* --- DOCK --- */
    .dock-bar {
        position: fixed; bottom: calc(30px + env(safe-area-inset-bottom)); left: 20px; right: 20px;
        background: var(--sheet-bg); backdrop-filter: var(--blur); -webkit-backdrop-filter: var(--blur);
        padding: 10px 15px; border-radius: 45px;
        display: flex; justify-content: space-between; align-items: center;
        box-shadow: 0 10px 25px rgba(0,0,0,0.15); border: 1px solid rgba(128,128,128,0.2); z-index: 100;
    }
    .dock-btn {
        width: 45px; height: 45px; border-radius: 50%; border: none;
        background: transparent; color: var(--accent); font-size: 1.4rem;
        display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        transition: transform 0.1s;
    }
    .dock-btn:active { transform: scale(0.9); background: rgba(128,128,128,0.15); }
    .dock-btn.main-action { background: var(--accent); color: #fff; box-shadow: 0 4px 12px rgba(0,122,255,0.4); width: 55px; height: 55px; font-size: 1.8rem; }
    
    /* BotÃ£o Novo Destacado */
    .dock-btn.new-note { color: var(--text); background: var(--btn-grey); font-weight: 600; font-size: 1.6rem; }

    /* --- SHEETS --- */
    .overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 200;
        opacity: 0; pointer-events: none; transition: opacity 0.3s; height: 100dvh; 
    }
    .overlay.active { opacity: 1; pointer-events: auto; }
    
    .sheet {
        position: absolute; bottom: 0; left: 0; right: 0;
        background: var(--sheet-bg); border-radius: 30px 30px 0 0;
        transform: translateY(100%); transition: transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.1);
        display: flex; flex-direction: column; max-height: 90dvh; 
        padding-bottom: env(safe-area-inset-bottom);
        backdrop-filter: var(--blur); -webkit-backdrop-filter: var(--blur);
        border-top: 1px solid rgba(255,255,255,0.1);
    }
    .overlay.active .sheet { transform: translateY(0); }
    .handle-area { width: 100%; padding: 15px 0; display: flex; justify-content: center; flex-shrink: 0; }
    .handle-bar { width: 40px; height: 5px; background: var(--border); border-radius: 10px; opacity: 0.8; }

    /* --- CALCULADORA --- */
    .calc-container { padding: 0 20px 20px 20px; display: flex; flex-direction: column; align-items: center; flex: 1; overflow-y: auto; }
    .display-wrapper { width: 100%; text-align: right; margin-bottom: 10px; flex-shrink: 0; }
    #calcResult {
        width: 100%; text-align: right; font-size: 3.5rem; border: none;
        background: transparent; color: var(--text); font-weight: 300; outline: none; margin: 0;
    }
    .history-dropdown {
        width: 100%; background: rgba(128,128,128,0.1); border-radius: 15px;
        max-height: 0; overflow-y: auto; transition: max-height 0.3s ease;
        margin-bottom: 10px; overscroll-behavior: contain; flex-shrink: 0;
    }
    .history-dropdown.open { max-height: 180px; border: 1px solid var(--border); }
    .hist-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: rgba(0,0,0,0.03); border-bottom: 1px solid var(--border); position: sticky; top: 0; }
    .btn-clear-hist { font-size: 0.8rem; color: var(--red); background: none; border: none; font-weight: 600; }
    .hist-list-content { padding: 5px; }
    .hist-entry { text-align: right; padding: 8px; border-bottom: 1px solid rgba(128,128,128,0.1); font-size: 1.1rem; color: var(--text); }

    .calc-tools { width: 100%; display: flex; justify-content: space-between; margin-bottom: 15px; padding: 0 5px; flex-shrink: 0; }
    .tool-btn { background: none; border: none; font-weight: 600; font-size: 0.95rem; color: var(--accent); padding: 5px; }
    .sci-row { display: none; grid-template-columns: repeat(5, 1fr); gap: 8px; width: 100%; margin-bottom: 10px; flex-shrink: 0; }
    .sci-row.show { display: grid; }
    .sci-btn { height: 40px; border-radius: 10px; border: none; background: var(--btn-grey); color: var(--text); font-size: 0.8rem; font-weight: 600; }
    .keypad { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; width: 100%; max-width: 380px; margin-bottom: 10px; flex-shrink: 0; }
    .key-btn { aspect-ratio: 1/1; width: 100%; max-width: 75px; border-radius: 50%; border: none; font-size: 1.7rem; background: var(--btn-grey); color: var(--btn-text); display: flex; align-items: center; justify-content: center; margin: 0 auto; }
    .key-btn:active { filter: brightness(0.85); }
    .key-btn.orange { background: var(--orange); color: #fff; }
    .key-btn.wide { grid-column: span 2; width: 100%; max-width: none; aspect-ratio: auto; height: 75px; border-radius: 40px; justify-content: flex-start; padding-left: 30px; }

    /* --- NOTAS E SELEÃ‡ÃƒO --- */
    .list-header-actions {
        display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px;
    }
    .btn-text-action { background: none; border: none; font-size: 1rem; color: var(--accent); font-weight: 600; }
    .btn-text-action.danger { color: var(--red); }

    .list-container { padding: 0 20px 20px 20px; overflow-y: auto; flex: 1; width: 100%; }
    
    .note-card {
        background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 10px;
        display: flex; align-items: center; gap: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.05);
        transition: transform 0.2s;
    }
    .note-card-text { flex: 1; overflow: hidden; cursor: pointer; }
    .btn-trash { background: rgba(255, 59, 48, 0.1); color: var(--red); border: none; width: 35px; height: 35px; border-radius: 50%; flex-shrink: 0; }

    /* Checkbox de seleÃ§Ã£o (escondido por defeito) */
    .note-checkbox {
        display: none; width: 22px; height: 22px; border-radius: 50%; border: 2px solid var(--border);
        appearance: none; -webkit-appearance: none; flex-shrink: 0;
        position: relative;
    }
    .note-checkbox:checked { background: var(--accent); border-color: var(--accent); }
    .note-checkbox:checked::after {
        content: 'âœ“'; position: absolute; color: #fff; font-size: 14px; 
        top: 50%; left: 50%; transform: translate(-50%, -50%);
    }
    /* Modo SeleÃ§Ã£o Ativo */
    .select-mode .note-checkbox { display: block; }
    .select-mode .btn-trash { display: none; } /* Esconde lixo individual no modo seleÃ§Ã£o */

</style>
</head>
<body data-theme="light">

    <div class="editor-area">
        <input type="text" id="titleInput" placeholder="TÃ­tulo">
        <textarea id="noteBody" placeholder="Escreve aqui... (ex: 10+20=)"></textarea>
        
        <div id="calcPreview" class="calc-preview-bubble">
            <b id="previewValue"></b>
            <span>(EspaÃ§o)</span>
        </div>
    </div>

    <div class="dock-bar">
        <button class="dock-btn" id="btnTheme">â—‘</button>
        <button class="dock-btn new-note" id="btnNew">ï¼‹</button> <button class="dock-btn main-action" id="btnOpenCalc">ðŸ§®</button>
        <button class="dock-btn" id="btnConverter">â‡„</button>
        <button class="dock-btn" id="btnSave">ðŸ’¾</button>
        <button class="dock-btn" id="btnList">â˜°</button>
    </div>

    <div class="overlay" id="modalCalc">
        <div class="sheet">
            <div class="handle-area"><div class="handle-bar"></div></div>
            <div class="calc-container">
                <div class="history-dropdown" id="historyDropdown">
                    <div class="hist-header"><span style="font-size:0.8rem;color:var(--text-sec)">HistÃ³rico</span><button class="btn-clear-hist" id="btnClearHist">Limpar</button></div>
                    <div class="hist-list-content" id="historyList"></div>
                </div>
                <div class="display-wrapper"><input id="calcResult" readonly value="0"></div>
                <div class="calc-tools"><button class="tool-btn" id="btnShowHist">ðŸ•’ HistÃ³rico</button><button class="tool-btn" id="btnToggleSci">CientÃ­fica</button><button class="tool-btn" style="color:var(--orange)" id="btnPaste">Inserir na Nota</button></div>
                <div class="sci-row" id="sciRow">
                    <button class="sci-btn" onclick="sci('sin')">sin</button><button class="sci-btn" onclick="sci('cos')">cos</button><button class="sci-btn" onclick="sci('tan')">tan</button><button class="sci-btn" onclick="sci('log')">log</button><button class="sci-btn" onclick="sci('sqrt')">âˆš</button><button class="sci-btn" onclick="ins('(')">(</button><button class="sci-btn" onclick="ins(')')">)</button><button class="sci-btn" onclick="sci('pow')">xÂ²</button><button class="sci-btn" onclick="ins('3.1415')">Ï€</button><button class="sci-btn" onclick="ins('2.7182')">e</button>
                </div>
                <div class="keypad">
                    <button class="key-btn" style="background:#d4d4d2;color:#000" onclick="cls()">AC</button><button class="key-btn" style="background:#d4d4d2;color:#000" onclick="del()">âŒ«</button><button class="key-btn" style="background:#d4d4d2;color:#000" onclick="ins('%')">%</button><button class="key-btn orange" onclick="ins('/')">Ã·</button><button class="key-btn" onclick="ins('7')">7</button><button class="key-btn" onclick="ins('8')">8</button><button class="key-btn" onclick="ins('9')">9</button><button class="key-btn orange" onclick="ins('*')">Ã—</button><button class="key-btn" onclick="ins('4')">4</button><button class="key-btn" onclick="ins('5')">5</button><button class="key-btn" onclick="ins('6')">6</button><button class="key-btn orange" onclick="ins('-')">âˆ’</button><button class="key-btn" onclick="ins('1')">1</button><button class="key-btn" onclick="ins('2')">2</button><button class="key-btn" onclick="ins('3')">3</button><button class="key-btn orange" onclick="ins('+')">+</button><button class="key-btn wide" onclick="ins('0')">0</button><button class="key-btn" onclick="ins('.')">,</button><button class="key-btn orange" onclick="calculate()">=</button>
                </div>
            </div>
        </div>
    </div>

    <div class="overlay" id="modalList">
        <div class="sheet">
            <div class="handle-area"><div class="handle-bar"></div></div>
            <div class="list-container">
                <div class="list-header-actions">
                    <h2 style="margin:0">Notas</h2>
                    <button class="btn-text-action" id="btnToggleSelect">Selecionar</button>
                    <button class="btn-text-action danger" id="btnDeleteSelected" style="display:none">Apagar</button>
                </div>
                <div id="notesContainer"></div>
            </div>
        </div>
    </div>

    <div class="overlay" id="modalConverter">
        <div class="sheet">
            <div class="handle-area"><div class="handle-bar"></div></div>
            <div class="calc-container">
                <h2 style="margin:0 0 20px 0">Conversor</h2>
                <div style="width:100%;margin-bottom:20px"><select id="convType" style="width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);font-size:1rem"><option value="distance">DistÃ¢ncia</option><option value="weight">Peso</option><option value="volume">Volume</option><option value="temperature">Temperatura</option></select></div>
                <div style="width:100%;margin-bottom:15px"><input id="convInput" type="number" placeholder="Valor" style="width:100%;padding:15px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);font-size:1.2rem"></div>
                <div style="width:100%;display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:center;margin-bottom:20px"><select id="convFrom" style="padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);font-size:1rem"></select><span style="font-size:1.5rem">â†’</span><select id="convTo" style="padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);font-size:1rem"></select></div>
                <div style="width:100%;padding:20px;background:rgba(0,122,255,0.1);border-radius:15px;text-align:center;margin-bottom:15px"><div style="font-size:0.9rem;color:var(--text);opacity:0.7;margin-bottom:5px">Resultado</div><div id="convResult" style="font-size:2rem;font-weight:600;color:var(--accent)">0</div></div>
                <button onclick="insertConversion()" style="width:100%;padding:15px;border-radius:12px;border:none;background:var(--orange);color:#fff;font-size:1.1rem;font-weight:600">Inserir na Nota</button>
            </div>
        </div>
    </div>

<script>
    const titleInput = document.getElementById('titleInput');
    const noteBody = document.getElementById('noteBody');
    const display = document.getElementById('calcResult');
    const historyDropdown = document.getElementById('historyDropdown');
    const historyList = document.getElementById('historyList');
    const calcPreview = document.getElementById('calcPreview');
    const previewValue = document.getElementById('previewValue');
    
    let savedNotes = JSON.parse(localStorage.getItem('appNotes') || '[]');
    let calcHistory = [];
    let pendingCalculation = null;
    let isSelectMode = false; // Estado para seleÃ§Ã£o mÃºltipla

    // --- NOVA NOTA (LÃ³gica Pedida) ---
    document.getElementById('btnNew').onclick = () => {
        const hasContent = titleInput.value.trim() || noteBody.value.trim();
        
        if (hasContent) {
            // Pergunta 1: Guardar?
            if (confirm("A nota atual tem conteÃºdo.\nDeseja GUARDAR antes de criar uma nova?")) {
                saveNote(); // Guarda
                clearEditor(); // Limpa
            } else {
                // Pergunta 2: Apagar?
                if (confirm("Deseja APAGAR o conteÃºdo atual e comeÃ§ar uma nota limpa?")) {
                    clearEditor();
                }
                // Se cancelar aqui, nÃ£o faz nada (mantÃ©m o texto)
            }
        } else {
            // Se jÃ¡ estava vazio, sÃ³ garante o foco
            clearEditor();
        }
    };

    function saveNote() {
        if(!titleInput.value.trim() && !noteBody.value.trim()) return;
        savedNotes.unshift({id: Date.now(), title: titleInput.value||'Sem TÃ­tulo', body: noteBody.value});
        localStorage.setItem('appNotes', JSON.stringify(savedNotes));
    }

    function clearEditor() {
        titleInput.value = ''; 
        noteBody.value = '';
        hidePreview();
        titleInput.focus();
    }

    // --- LÃ“GICA DE PREVIEW (Smart Calc) ---
    noteBody.addEventListener('input', (e) => {
        if (e.data !== '=') { hidePreview(); return; }
        const val = e.target.value;
        const match = val.match(/(?:^|[\n\s])([0-9.,+\-*/()]+)=$/);
        if (match) {
            const expression = match[1].replace(/,/g, '.');
            try {
                let result = eval(expression);
                if(!Number.isInteger(result)) result = parseFloat(result.toFixed(2));
                pendingCalculation = result;
                showPreview(result);
            } catch (err) { hidePreview(); }
        }
    });

    noteBody.addEventListener('keydown', (e) => {
        if ((e.key === ' ' || e.code === 'Space') && pendingCalculation !== null) {
            e.preventDefault();
            noteBody.value += pendingCalculation;
            hidePreview();
        }
    });

    function showPreview(val) { previewValue.textContent = val; calcPreview.classList.add('active'); }
    function hidePreview() { calcPreview.classList.remove('active'); pendingCalculation = null; }

    // --- UI GERAL ---
    document.getElementById('btnTheme').onclick = () => { document.body.dataset.theme = document.body.dataset.theme === 'light' ? 'dark' : 'light'; };
    
    // --- CALCULADORA ---
    function ins(v) { if(display.value==='0'&&!isNaN(v))display.value=''; if(display.value==='Erro')display.value=''; display.value+=v; }
    function cls() { display.value = '0'; }
    function del() { display.value = display.value.length>1 ? display.value.slice(0,-1) : '0'; }
    function calculate() { try{ let expr=display.value.replace(/Ã—/g,'*').replace(/Ã·/g,'/'); let result=eval(expr); if(!Number.isInteger(result))result=parseFloat(result.toFixed(4)); addToHistory(display.value, result); display.value=result; }catch{display.value='Erro';} }
    function sci(f) { try{ let v=eval(display.value); let r=f==='sqrt'?Math.sqrt(v):f==='pow'?Math.pow(v,2):Math[f](v); if(!Number.isInteger(r))r=parseFloat(r.toFixed(6)); addToHistory(`${f}(${v})`, r); display.value=r; }catch{display.value='Erro';} }
    
    function addToHistory(op, res) { calcHistory.unshift(`${op} = ${res}`); renderHistory(); }
    function renderHistory() { historyList.innerHTML = calcHistory.map(h => `<div class="hist-entry">${h}</div>`).join(''); }
    document.getElementById('btnClearHist').onclick = (e) => { e.stopPropagation(); calcHistory=[]; renderHistory(); };
    document.getElementById('btnShowHist').onclick = (e) => { e.stopPropagation(); historyDropdown.classList.toggle('open'); };
    document.getElementById('btnToggleSci').onclick = (e) => { e.stopPropagation(); document.getElementById('sciRow').classList.toggle('show'); };
    document.getElementById('btnPaste').onclick = (e) => { e.stopPropagation(); if(display.value!=='Erro') noteBody.value+=(noteBody.value?'\n':'')+display.value; };

    // --- NOTAS & SELEÃ‡ÃƒO MÃšLTIPLA ---
    
    // Renderiza a lista
    function renderNotes() {
        const c = document.getElementById('notesContainer');
        const containerClass = isSelectMode ? 'list-container select-mode' : 'list-container';
        c.parentElement.className = containerClass; // Aplica classe ao pai para CSS
        
        c.innerHTML = savedNotes.length ? '' : '<p style="text-align:center;color:#888">Vazio</p>';
        
        savedNotes.forEach(n => {
            const div = document.createElement('div');
            div.className = 'note-card';
            
            // Checkbox (SeleÃ§Ã£o)
            const checkbox = `<input type="checkbox" class="note-checkbox" value="${n.id}">`;
            
            // Texto (Click abre nota SE nÃ£o estiver em modo seleÃ§Ã£o)
            const textContent = `<div class="note-card-text" onclick="${isSelectMode ? `toggleCheck(${n.id})` : `loadNote(${n.id})`}"><h4>${n.title}</h4><p>${n.body.substring(0, 40)}${n.body.length>40?'...':''}</p></div>`;
            
            // BotÃ£o Lixo (Individual)
            const trashBtn = `<button class="btn-trash" onclick="deleteNote(${n.id})">ðŸ—‘</button>`;
            
            div.innerHTML = checkbox + textContent + trashBtn;
            c.appendChild(div);
        });

        // Atualiza botÃµes do header
        document.getElementById('btnToggleSelect').textContent = isSelectMode ? 'Cancelar' : 'Selecionar';
        document.getElementById('btnDeleteSelected').style.display = isSelectMode ? 'block' : 'none';
    }

    // Toggle SeleÃ§Ã£o
    document.getElementById('btnToggleSelect').onclick = () => {
        isSelectMode = !isSelectMode;
        renderNotes();
    };

    // Helper para clicar no card e marcar a checkbox
    window.toggleCheck = (id) => {
        const check = document.querySelector(`input[value="${id}"]`);
        if(check) check.checked = !check.checked;
    };

    // Apagar Selecionadas
    document.getElementById('btnDeleteSelected').onclick = () => {
        const checked = document.querySelectorAll('.note-checkbox:checked');
        if (checked.length === 0) return alert("Nenhuma nota selecionada.");
        
        if (confirm(`Apagar ${checked.length} notas?`)) {
            const idsToDelete = Array.from(checked).map(cb => parseInt(cb.value));
            savedNotes = savedNotes.filter(n => !idsToDelete.includes(n.id));
            localStorage.setItem('appNotes', JSON.stringify(savedNotes));
            isSelectMode = false; // Sai do modo seleÃ§Ã£o
            renderNotes();
        }
    };

    document.getElementById('btnSave').onclick = () => { saveNote(); alert("Guardado!"); };
    
    window.loadNote = (id) => {
        const n = savedNotes.find(x => x.id === id);
        if(n) { titleInput.value = n.title; noteBody.value = n.body; closeModal('modalList'); }
    };
    
    window.deleteNote = (id) => {
        if(confirm("Apagar esta nota?")) {
            savedNotes = savedNotes.filter(n => n.id !== id);
            localStorage.setItem('appNotes', JSON.stringify(savedNotes));
            renderNotes();
        }
    };

    // --- MODAL SYSTEM ---
    function openModal(id) { 
        const overlay = document.getElementById(id);
        const sheet = overlay.querySelector('.sheet');
        sheet.style.cssText = ''; void sheet.offsetWidth; 
        overlay.classList.add('active'); 
        if(id==='modalList') { isSelectMode=false; renderNotes(); } // Reset seleÃ§Ã£o ao abrir
        if(id==='modalConverter') initConverter(); 
    }
    function closeModal(id) { 
        const overlay = document.getElementById(id);
        const sheet = overlay.querySelector('.sheet');
        overlay.classList.remove('active');
        setTimeout(() => { sheet.style.cssText = ''; }, 350);
    }
    document.getElementById('btnOpenCalc').onclick = () => openModal('modalCalc');
    document.getElementById('btnList').onclick = () => openModal('modalList');
    document.getElementById('btnConverter').onclick = () => openModal('modalConverter');
    
    document.querySelectorAll('.overlay').forEach(overlay => {
        overlay.addEventListener('click', e => { if(e.target === overlay) closeModal(overlay.id); });
        const sheet = overlay.querySelector('.sheet');
        let startY = 0; let currentY = 0;
        sheet.addEventListener('touchstart', (e) => {
            const isScrollable = e.target.closest('.history-dropdown, .list-container, .calc-container');
            if (isScrollable && isScrollable.scrollTop > 0) return;
            startY = e.touches[0].clientY; sheet.style.transition = 'none';
        }, {passive: true});
        sheet.addEventListener('touchmove', (e) => {
            if(startY === 0) return; currentY = e.touches[0].clientY;
            if((currentY - startY) > 0) { if(e.cancelable) e.preventDefault(); sheet.style.transform = `translateY(${currentY - startY}px)`; }
        }, {passive: false});
        sheet.addEventListener('touchend', (e) => {
            if(startY === 0) return;
            sheet.style.transition = ''; 
            if((currentY - startY) > 120) { sheet.style.transform = ''; overlay.classList.remove('active'); } 
            else { sheet.style.transform = ''; }
            startY = 0; currentY = 0;
        });
    });

    // --- CONVERSOR ---
    const conversions = {
        distance: { units: ['metros', 'quilÃ³metros', 'milhas', 'pÃ©s', 'polegadas', 'centÃ­metros'], toBase: { metros: 1, quilÃ³metros: 1000, milhas: 1609.34, pÃ©s: 0.3048, polegadas: 0.0254, centÃ­metros: 0.01 } },
        weight: { units: ['gramas', 'quilogramas', 'libras', 'onÃ§as', 'toneladas'], toBase: { gramas: 1, quilogramas: 1000, libras: 453.592, onÃ§as: 28.3495, toneladas: 1000000 } },
        volume: { units: ['litros', 'mililitros', 'galÃµes', 'copos', 'metros cÃºbicos'], toBase: { litros: 1, mililitros: 0.001, galÃµes: 3.78541, copos: 0.24, 'metros cÃºbicos': 1000 } },
        temperature: { units: ['Celsius', 'Fahrenheit', 'Kelvin'], convert: (val, from, to) => { let celsius = from === 'Celsius' ? val : from === 'Fahrenheit' ? (val - 32) * 5/9 : val - 273.15; return to === 'Celsius' ? celsius : to === 'Fahrenheit' ? celsius * 9/5 + 32 : celsius + 273.15; } }
    };
    function initConverter() { updateUnits(); document.getElementById('convType').onchange = updateUnits; document.getElementById('convInput').oninput = convert; document.getElementById('convFrom').onchange = convert; document.getElementById('convTo').onchange = convert; }
    function updateUnits() { const type = document.getElementById('convType').value; const units = conversions[type].units; const html = units.map(u => `<option value="${u}">${u}</option>`).join(''); document.getElementById('convFrom').innerHTML = html; document.getElementById('convTo').innerHTML = html; document.getElementById('convTo').selectedIndex = 1; convert(); }
    function convert() { const type = document.getElementById('convType').value; const val = parseFloat(document.getElementById('convInput').value) || 0; const from = document.getElementById('convFrom').value; const to = document.getElementById('convTo').value; let result; if (type === 'temperature') { result = conversions.temperature.convert(val, from, to); } else { const base = val * conversions[type].toBase[from]; result = base / conversions[type].toBase[to]; } document.getElementById('convResult').textContent = result.toFixed(4); }
    function insertConversion() { const val = document.getElementById('convInput').value; const from = document.getElementById('convFrom').value; const to = document.getElementById('convTo').value; const result = document.getElementById('convResult').textContent; const text = `${val} ${from} = ${result} ${to}`; noteBody.value += (noteBody.value ? '\n' : '') + text; }
</script>
</body>
</html>
    
